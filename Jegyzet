-----------------------
ZH LÉPÉSEK
-----------------------

(emlékeztetésnek, management mindig a LAN oldalról éri le a routert, ennek megfelelően kell vmbridge-t állítani és frissíteni a kapcsolatot amikor másik routerre váltunk)
!!Limitált tárhelyünk van, ne adjunk feleslegesen sok helyet mindennek, routereknek 16GB, maximum 32GB helyet adunk (még nem 100% hogy ez a probléma, de 64 GB nem kell egy routernek)

R2  - megfelelő bridge-ket beállítjuk, WAN oldalra már vmbr1, LAN oldalra vmbr2 (vagy amit létrehozunk, figyeljünk arra hogy vlan aware legyen)
    - telepítéskor megállítjuk az interfészbeállításért, a megfelelőt beállítjuk WAN-nak és LAN-nak (általában vtnet0 és vtnet1)
    - installer/opnsense fiókkal lépünk be, így telepítjük  
      - billentyűkiosztásnál magyar 102 billentyűs
      - enter, enter, space, enter, yes, enter
      (- hosszabb várás jön, ilyenkorra érdemes lenne berakni valamit, bridge-k létrehozása, container-ek létrehozása, stb.)
      - megváltoztatjuk a root password-öt
      - complete installation
    - bejelentkezés után a 2., ip beállítást választjuk
      - WAN, n, 192.168.1.50, 24, 192.168.1.1 (nem tudom kell-e ez), y, n, enter, n, n, n
      - LAN, n, 10.0.0.1, 24, enter, y, n, enter, y, 10.0.0.150, 10.0.0.200, n, n, n
    - ezután R2 képes az internetet pingelni
    - Web GUI
      - ellenőrizhetjük az eddigi beállításokat, de elméletben megjegyzi őket és hatásba lépnek
      - ****EZEN A PONTON ÉRDEMES LEKLÓNOZNUNK, KÉSŐBB NAGYOBB SZENVEDÉS LESZ**** (további infó R3-nál)
      - VLAN-ok beállítása jön
      - létrehozzuk a vlan-okat, üres "device" rész, parent legyen a LAN, vlan tag a megfelelő szám, és description ajánlatos (pl. vlan10)
        - ha létrehoztuk mindhármat akkor Apply
      - Assignments, kiválasztjuk a vlant és adunk neki egy descriptiont (pl. vlan10)
        - ha mindhárom kész akkor Save
      - egyenként mindhárom vlan-on (az interfész részben)
        - Enable interface, static ipv4, ip-hez 10.0.X.1 ahol az X a vlan száma, /24
          - Save, és Apply Changes
      - DHCP jön, mindegyik vlan-hoz
        - services, dhcpv4, megfelelő vlan
        - enable, range: 10.0.X.150-10.0.X.200 (semmi más)
        - ha statikus dhcp mapping kell, mint R3-hoz, akkor
          - legalul DHCP static mapping, + jel
          - az R3 külső bridge-ének a mac address-e, ip address (10.0.10.50), Save
      - ha ezekkel megvagyunk akkor következőnek a tűzfal jön:
        - minden vlan-hoz beteszünk két szabályt, egy ami befelé (in) enged mindent, és egyet ami kifelé (out) enged mindent
      - tiltások:
        - interface vlan20, direction in, protocol tcp/udp, source vlan20 net, destination vlan30 net, destination port other, range 10000
        - interface vlan30, direction in, protocol tcp/udp, source 10.0.30.10/32, destination 10.0.20.10/32, destination port other, range 9000

R3  - LEKLÓNOZZUK AZ R2-ŐT, DE MÉG NEM INDÍTJUK EL
    - létrehozzuk a vmbr3-at ha még nem tettünk
    - Hardware, network device, az elsőt átállítjuk vmbr2-re és vlan tag-et adunk neki (10), a másodikat átállítjuk vmbr3-ra
    - belépés után átállítjuk az ip-ket:
      - WAN, Y, n, enter, y, n, enter, n, n, n
      - LAN, n, 20.0.0.1, 24, enter, y, n, enter, y, 20.0.0.150, 20.0.0.200, n, n, n
    (- ilyenkor érdemes visszatérni az R2-nél a DHCP-nél a statikus mapping-hez, mivel már megvan a mac address)
    - ping google.com tesztelése
        - ha nem működik, akkor ping 10.0.10.50 tesztelése    
        - ha ez se működik akkor web gui-ban: system -> gateways -> configuration, amelyiknél "(upstream)" van írva azt szerkesszük és vegyük ki

Containerek: név, jelszó, erőforrásoknál több legyen a szervernek, network-nél jó bridge, jó vlan, jó ip cím, jó gateway
    (- apt update és apt ugrade is lehet akár)

!!!Wazzuh még nincs biztosan megcsinálva
!Wazzuh Szerver
!    - adduser student
!    - usermod -aG sudo student
!    - su student
!    - cd
!    - https://docs.docker.com/engine/install/ubuntu/ (apt-os download)
!    - sudo usermod -aG docker student
!    - https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html , single node, git clone-os parancs, wazzuh self-signed certificates (2. lépése csak), deployment

AM  - https://docs.ansible.com/ansible/latest/installation_guide/installation_distros.html (ubuntu)
    - cd ./etc/ansible
    - nano hosts
        [system:children]
        vlan20
        vlan30

        [vlan20]
        10.0.20.20

        [vlan30]
        10.0.30.10

        [system:vars]
        ansible_user=ansible
        ansible_password=ansible
        ansible_become_user=ansible
        ansible_become_method=sudo
        ansible_become_password=ansible
        -nano ansible.cfg
            [defaults]
            host_key_checking = false #kényelmi beállítás
        - ansible all -m ansible.builtin.ping

TESZT, AS1
    - adduser ansible (ansible jelszóval, többi nem kell)
    - usermod -aG sudo ansible

TESZT, BASTION, INSIDE
    - adduser student (student jelszó)

BASTION
    - nano /etc/ssh/sshd_config: PasswordAuthentication no , majd systemctl restart ssh
    - nano /etc/hosts.allow: sshd: 10.0.30.10
    - nano /etc/hosts.deny: sshd: all
    (- mindent student felhasználóval csináljunk, student-nél legyenek a .ssh mappák)
    - (TESZT gépen ssh-keygen) nano ./ssh/authorized_keys: <TESZT gép .ssh/id_rsa.pub kulcsa>
    - ssh-keygen

TESZT
    - ssh-keygen
    - nano .ssh/config
        Host bastion
          User student
          IdentityFile /home/student/.ssh/id_rsa
          Port 22
          HostName 10.0.30.20
        Host belso1
          User student
          IdentityFile /home/student/.ssh/id_rsa
          Port 22
          HostName 10.0.30.30
          ProxyJump bastion
((nem vagyok 100%-ig biztos az identityfile-ban))


INSIDE
    - nano /etc/ssh/sshd_config: PasswordAuthentication no , majd systemctl restart ssh
    - (BASTION gépen ssh-keygen) nano ./ssh/authorized_keys: BASTION gép .ssh/id_rsa.pub kulcsa>



-----------------------

((tartalom)) -- nem olyan fontos

Group5.netsec.infra.inf.unideb.hu
login: root student

1. vlan konfigurálás: interfaces, other devices, vlan -> interfaces, assigment -> vlan, enable interface, ne blokkoljunk semmit, ip cím -> services, dhcp

2. container, templateből, 1024 ram, egyéb

3. firewall, rules, <interfész>, (pl.) direction: vlan10 net

4. tűzfal portletiltás/átengedés; firewall, rules, direction, protocol, source, dest, port; sorrend fentről le

5. bastion host, /etc/hosts.allow, /etc/hosts.deny: sshd: ip/all; ssh-keygen kliensen; bastion-ben ./ssh/authorized_keys -be a kulcs;
.ssh/config kliensen:
Host bastion
  User student #célpont gépen név
  IdentityFile /home/student/.ssh/bastion #saját gépen lévő fájl
  Port 22 #célpont nyitott portja
  HostName <ip> #célpont ipje
Host belso1
  User student
  IdentityFile /home/student/.ssh/bastion #lehet külön kulcs
  Port 22
  HostName <ip> #belső ip
  ProxyJump #melyik gépen keresztül lépek be
belső gépen ./ssh/authorized_keys -be a kulcs
bastion-ön és belső gépe(ke)n /etc/ssh/sshd_config: PasswordAuthentication no, majd systemctl restart ssh
((ubuntu server download online, linket bemásoljuk a proxmox local iso images és from url))

((6. monitoring rendszerek: System monitoring, Application monitoring, Intrusion detection/prevention software (IDS/IPS)
  Network IDS/IPS és Host IDS/IPS: Wazuh (ELK stackre épül)
  System monitoring (mindig host alapú): Zabbix és Nagios))

7. Wazzuh:
  docker -> containerization
  VM, megfelelő erőforrások, hálózatba bevonás
  rássh-zunk egy grafikus gépről (tűzfalon engedjük át), https://docs.docker.com/engine/install/ubuntu/ első három (apt-os download)
  adduser student
  sudo usermod -aG sudo student
  sudo usermod -aG docker student
  wazzuh docker: https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html , single node, git clone-os parancs, wazzuh self-signed certificates (optional nem számít), deployment
  wazuh agent: valamelyik másik gépre, https://documentation.wazuh.com/current/installation-guide/wazuh-agent/wazuh-agent-package-linux.html

8. Zabbix (Nagios)
  új container (név, jelszó, template, 20GB, 2, 1024Mb, hálózat/ip)
  sudo apt install mariadb-server, mysql_secure_installation (enter, Y, n, Y, Y, Y, Y), https://www.zabbix.com/download?zabbix=7.4&os_distribution=ubuntu&os_version=22.04&components=server_frontend_agent&db=mysql&ws=apache
  kiválasztjuk az opciókat, (jelszó és felhasználónevet átírjuk) create user zabbix@localhost identified by 'password'; , zcat parancs hosszú ideig fut és módosítsuk a felhasználónevet ha kell, jelszó amit most adtunk meg
  dockerben locale-gen "en-US", dpkg-reconfigure locales és kiválasztjuk az en-US UTF-8-as verziót, default-nak betesszük, majd reboot
  megnyitjuk ip/zabbix webhelyet (Admin/zabbix), next, beállítunk mindent (vagy csak a jelszót), szervernévnek valami, időzóna -> belépünk
  agent telepítés, ugyan az a weboldal csak agent-öt választunk, telepítés után nano /etc/zabbix/zabbix_agentd.conf és beírjuk a jó helyre a szerver ipjét, majd agent-öt újraindítjuk
  Networking, Hosts, Create host, név, template group, Linux by Zabbix, host groups, linux servers, interfaces: agent és az agent ip címe (confirmölés után online-nak kell lennie egy kis idő után)
  Monitoring, triggers, new trigger, add condition

9. Ansible
  ((még Puppet, Chef; Ansible GUI az a Semaphore UI))
  Ansible előnye hogy nem kellenek ágensek, csak ssh kell
  https://docs.ansible.com/ansible/latest/installation_guide/installation_distros.html (ubuntu része)
  cd ./etc/ansible
  nano hosts,
    [csoport]
    <ip>
    <ip>
    ...
    [csoport:vars]
    ansible_user=
    ansible_password=
    #csak ha kell rendszergazdai jog
    ansible_become_user= 
    #su - rendszergazda jelszava; sudo - felhasználó jelszava (sudo-nál usermod -aG sudo <felhasználó> a megfelelő felhasználóra)
    ansible_become_method=
    ansible_become_password=
  nano ansible.cfg
    [defaults]
    host_key_checking = false #kényelmi beállítás
  ansible all -m ansible.builtin.ping (megnézi hogy elérhetőek-e a gépek) (ssh-t állítsunk ha nem enged)
  ansible all -m ansible.builtin.command whoami
  https://arato.inf.unideb.hu/bertok.csanad/ playbook-okhoz példa
    alap struktúránál ha a tasks felé beírjuk a "become: true" akkor rendszergazdaként is futtathatunk
    ansible playbook <playbook.yml>
      -e <változó=érték> -- amit átadunk a playbooknak
    chatgpt további segítségnek

DECEMBER 2 ZH

tippek:
  routereket klónozni gyorsabb
  neveket őrizzük meg
  
pl. feladatra
  első router: create vm, bridge vmbr1
  (proxmox csoportra kattintva) create linux bridge, vmbr2, vlan aware
  routernél add network device, vmbr2
  routert elindítjuk, telepítjük,
